# Section 20 - 애플리케이션 개발을 위한 모범 사례 

## 모든 것을 하나로 모아보기

![](https://github.com/keepinmindsh/lines_kubernetes/blob/main/assets/k8s_usage_001.png) 

일반적인 애플리케이션 매니페스트에는 하나 이상의 디플로이먼트나 스테이트풀셋 오브젝트가 포함된다. 여기에는 하나 이상의 컨테이너 포함된 파드 템플릿, 각 컨테이너에  
대한 라이브니스 프로브와 컨테이너가 제공하는 서비스에 대한 레디니스 프로브가 포함된다. 다른 사람에게 서비스를 제공하는 파드는 하나 이상의 서비스로 노출된다.  
클러스터 외부로 통신할 수 있어야 하는 경우 서비스는 로드밸런서나 노드포트 유형 서비스로 구성되거나 인그레스 리소스로 노출된다.   

  애플리케이션에는 환경 변수를 초기화하거나 파드에 컨피그맵 볼륨으로 마운트 되는 하나 이상의 컨피그 맵이 포함돼 있다. 특정 파드는 emptyDir 또는 gitRepo 볼륨과  
같은 추가 볼륨을 사용하는 반면, 퍼시스턴트 스토리지가 있어야 하는 파드는 퍼시스턴트 볼륨 클레임 볼륨을 사용한다. 퍼시스턴트 볼륨 클레임은 애플리케이션 매니페스트에 속하며,  
이에 의해 참조된 스토리지클래스는 시스템 관리자가 미리 생성된다.   

 경우에 따라 애플리케이션에서 잡이나 크롭잡을 사용해야 한다. 데몬셋은 일반적으로 애플리케이션 디플로이먼트 일부는 아니지만 일반적으로 시스템 운영자가 노드 전체 또는 일부에  
시스템 서비스를 실행하려고 생성한다. 수평 파드 오토 스케일러는 개발자가 매니페스트에 포함시키거나 나중에 운영 팀이 시스템에 추가한다. 또한 클러스터 관리자는 
제한 범위와 리소스 쿼터 오브젝트를 생성해 개별 파드와 모든 파드의 리소스 사용량을 제어할 수 있다.  

애플리케이션이 배포되면 다양한 쿠버네티스 컨트롤러에 의해 오브젝트가 추가적으로 자동 생성된다. 여기에는 엔드포인트 컨트롤러로 생성된 서비스 엔드포인트 오브젝트, 디플로이먼트 컨트롤러로 생성된  
레플리카셋과 레플리카셋, 잡, 크론잡, 스테이트풀셋, 데몬셋 컨트롤러로 생성된 실제 파드가 포함된다. 

리소스는 종종 체계적으로 유지되기 위해서 하나 이상의 레이블을 지정한다. 이는 파드에만 적용되는것이 아니라 다른 모든 리소스에도 적용된다. 이는 파드에만 적용되는 것이 아니라 다른 모든 리소스에도 적용된다.  
레이블 외에도 대부분의 리소스에는 각 리소스를 설명하거나 해당 담당자 또는 팀의 연락처 정보를 나열하거나 관리와 기타 도구에 관한 추가 메타 데이터를 제공하는 어노테이션이 포함돼 있다. 

## 파드 라이프 사이클 이해

### 애플리케이션을 종료하고 파드 재배치 예상하기 

#### 로컬 IP와 호스트 이름 변경 예상하기  

파드가 종료되고 다른 곳에서 실행되면 새로운 IP 주소뿐만 아니라 새로운 이름과 호스트 이름을 갖는다. 대부분의 스테이트리스 애플리케이션은 일반적으로 문제 없이  
처리할 수 있지만 스테이트풀 애플리케이션은 그렇지 않다. 스테이트 풀 애플리케이션을 스테이트풀셋으로 실행할 수 있다는 사실을 알고 있으므로 스케줄링을 조정한 후 새 노드에서  
애플리케이션을 시작할 때도 여전히 이전과 동일한 호스트 이름과 퍼시스턴트 상태를 볼 수 있다. 그럼에도 파드의 IP는 변경될 것이다. 이를 위해서 애플리케이션이 미리 준비되어 잇어야 한다. 
따라서 애플리케이션 개발자는 클러스터된 애플리케이션의 구성원을 IP 주소 기반으로 하면 안 되며 호스트 이름을 기반으로 할 때에는 항상 스테이트 풀셋을 사용해야 한다. 

#### 디스크에 기록된 데이터가 사라지는 경우 예상하기 

애플리케이션이 디스크에 데이터를 쓰는 경우 애플리케이션이 쓰는 위치에 퍼시스턴트 스토리지를 마운트 하지 않으면 애플리케이션이 새 파드로 시작된 후에  
해당 데이터를 사용하지 못할 수도 있다는 것! 

![](https://github.com/keepinmindsh/lines_kubernetes/blob/main/assets/k8s_usage_002.png)

#### 컨테이너를 다시 사용하더라도 데이터를 보존하기 위해 볼륨 사용하기 

데이터가 손실되지 않도록 하려면 최소한 파드 범위의 볼륨을 사용해야 한다. 볼륨이 파드와 함께 시작하고 종료하기 때문에 새 컨테이너는 이전 컨테이너가 볼륨에 
기록한 데이터를 재사용 할 수 있다. 

![](https://github.com/keepinmindsh/lines_kubernetes/blob/main/assets/k8s_usage_003.png)

컨테이너를 재시작할 대 파일을 보존하려고 불륨을 사용하는 것은 좋은 생각이지만 항상 그런 것은 아니다. 데이터가 손상돼 새로 생성된 프로세스가 다시 크래시되면 
어떻게 할까? 이로 인해 연속 크래시 루프가 발생한다. 볼륨을 사용하지 않은 경우 새컨테이너가 처음부터 시작돼 크래시하지 않을 가능성이 높다. 
컨테이너를 재시작할 때 파일을 보존하려고 불륨을 사용하는 것은 양날의 검이다. 

#### 

## 모든 클라이언트 요청의 적절한 처리 보장
## 쿠버네티스에서 애플리케이션을 쉽게 실행하고 관리할 수 있게 만들기
## 개발 및 테스트 모범 사례 